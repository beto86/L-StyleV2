{% extends 'modelo.html' %}

{% load static %}

{% block titulo %}
<title>Relatório</title>
{% endblock %}

{% block conteudo %}
<div class="relatorio">
    <h3 class="title border-custom-primary">Pagina de Relatórios</h3>
    <div class="box">
        <div class="left">
            <canvas id="mediaTurma"></canvas>
            <canvas id="mediaPorCurso" style="display: none;"></canvas>
        </div>
        <div class="right">
            <div class="tabMenu">
                <h1 class="btnRelNav active" style="border-bottom-color: #ffcc44;" data-role="sortByTurma">Tentativas da Turma</h1> 
                <h1 class="btnRelNav" data-role="sortByCourse">Tentativas por curso</h1>           
            </div>
            <form action="" method="GET" class="formulario" id="turmaForm">
                <label for="turmas">Escolha uma Turma:</label>


                <select name="turmas" id="turmas">
                    {% for t in turmas %}
                    <option value="{{ t }}">{{ t }}</option>
                    {% endfor %}
                </select>
                <input type = 'submit' value="Submit" class="btn">
            </form>
            <form action="" method="GET" class="formulario" id="cursoForm" style="display: none;">
                {% csrf_token %}
                <label for="turmas">Escolha um Curso:</label>

                <select name="cursos" id="cursos">
                    {% for t in cursos %}
                    <option value="{{ t.curso }}">{{ t.curso }}</option>
                    {% endfor %}
                </select>
                <input type = 'submit' value="Submit" class="btn">
            </form>
        </div>
    </div>
</div>

<div class="table-info table-responsive">
    <table class="table table-striped" id="tabela-listar" style="min-width: 800px;">
        <thead>
            <tr>
                <th>Teste</th>
                <th>Quem respondeu</th>
                <th>Data</th>
                <th>Estilo</th>
            </tr>
        </thead>
        <tbody>
            {% for t in evlTurma %}
            <tr>
                <td>{{t.teste.descricao}}</td>
                <td>{{t.usuario}}</td>
                <td>{{t.data}}</td>
                <td>{{t.estilo}}</td>
            </tr>
            {% empty %}
            <td colspan="3">Nenhuma tentativa registrada.</td>
            {% endfor %}
        </tbody>
    </table>
</div>

<!--  DAQUI EM DIANTE ESTA SEM ESTILO -->
<hr>
        <h1>Tentativas por curso {{nome_turma_curso}}</h1>
        <div class="table-responsive">
            <table class="table table-striped" id="tabela-listar">
                <thead>
                    <tr>
                        <th>Teste</th>
                        <th>Quem respondeu</th>
                        <th>Data</th>
                        <th>Estilo</th>
                    </tr>
                </thead>
                <tbody>
                    {% for t in evlCurso %}
                    <tr>
                        <td>{{t.teste.descricao}}</td>
                        <td>{{t.usuario}}</td>
                        <td>{{t.data}}</td>
                        <td>{{t.estilo}}</td>
                    </tr>
                    {% empty %}
                    <td colspan="3">Nenhuma tentativa registrada.</td>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <hr>
        <hr>
        <canvas id="evolucaoTurma" style="max-width: 600px; max-height: 600px;"></canvas>
        <hr>
        <hr>
        <canvas id="evolucaoCurso" style="max-width: 600px; max-height: 600px;"></canvas>
        <hr>
{% endblock %}

{% block scripts %}

<script src="{% static 'js/Chart.min.js' %}"></script>
<script src="{% static 'js/relatorio.js' %}"></script>
<script>
    $(document).ready(function () {
        //relatório para a media da turma de estilo de aprendizagem
        var ctx = $('#mediaTurma');

        var dados = {
            labels: ['Assimilador', 'Convergente', 'Divergente', 'Acomodador'],
            datasets: [
                { // Depois os dados/média da turma
                    label: 'Geral da Turma',
                    data: [{{ Assimilador }}, {{ Convergente }}, {{ Divergente }}, {{ Acomodador }}],
                    fill: true,
                    backgroundColor: [
                    'rgba(255, 99, 132, 0.3)',
                    'rgba(54, 162, 235, 0.3)',
                    'rgba(255, 206, 86, 0.3)',
                    'rgba(0, 255, 0, 0.3)',
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(0, 255, 0, 1)',
                    ],
                    borderWidth: 1
                }
            ] // fim dos conjuntos
        };

        var config = {
            maintainAspectRatio: true,
            title: {
                display: true,
                text: 'Tentativas da turma',
                fontSize: 30,
                fontColor: '#273c75'
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true,
                        stepSize: 1
                    }
                }]
            },
        };

        var myChart = new Chart(ctx, {
            type: 'bar',
            data: dados,
            options: config,
        });

        //relatório para a media por curso de estilo de aprendizagem
        var ctx = $('#mediaPorCurso');

        var dados = {
            labels: ['Assimilador', 'Convergente', 'Divergente', 'Acomodador'],
            datasets: [
                { // Depois os dados/média da turma
                    label: 'Geral da Turma',
                    data: [{{ AssimiladorCurso }}, {{ ConvergenteCurso }}, {{ DivergenteCurso }}, {{ AcomodadorCurso }}],
                    fill: true,
                    backgroundColor: [
                    'rgba(255, 99, 132, 0.3)',
                    'rgba(54, 162, 235, 0.3)',
                    'rgba(255, 206, 86, 0.3)',
                    'rgba(0, 255, 0, 0.3)',
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(0, 255, 0, 1)',
                    ],
                    borderWidth: 1
                }
            ] // fim dos conjuntos
        };

        var config1 = {
            maintainAspectRatio: true,
            title: {
                display: true,
                text: 'Tentativas por Curso',
                fontSize: 30,
                fontColor: '#273c75'
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true,
                        stepSize: 1
                    }
                }]
            },
        };

        var ChartCurso = new Chart(ctx, {
            type: 'bar',
            data: dados,
            options: config1,
        });

        //Relatório por turma contendo a evolução da turma, gráfico de linha
        var ctx = $('#evolucaoTurma');

        var dados = {
            labels: ['Jan', 'Fev', 
                    'Mar', 'Abr', 
                    'Maio', 'Jun', 
                    'Jul', 'Ago', 
                    'Set', 'Out', 
                    'Nov', 'Dez',
                ],
            datasets: [
                { 
                    label: 'Assimilador',
                    data: [{{evlAssJan}}, {{evlAssFev}}, 
                            {{evlAssMar}}, {{evlAssAbr}}, 
                            {{evlAssMai}}, {{evlAssJun}}, 
                            {{evlAssJul}}, {{evlAssAgo}}, 
                            {{evlAssSet}}, {{evlAssOut}}, 
                            {{evlAssNov}}, {{evlAssDes}}
                        ],
                    fill: false,
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 3,
                    backgroundColor: 'transparent',
                },
                { 
                    label: 'Convergente',
                    data: [{{evlConJan}}, {{evlConFev}}, 
                            {{evlConMar}}, {{evlConAbr}}, 
                            {{evlConMai}}, {{evlConJun}}, 
                            {{evlConJul}}, {{evlConAgo}}, 
                            {{evlConSet}}, {{evlConOut}}, 
                            {{evlConNov}}, {{evlConDes}}
                        ],
                    fill: false,
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 3,
                    backgroundColor: 'transparent',
                },
                { 
                    label: 'Divergente',
                    data: [{{evlDivJan}}, {{evlDivFev}}, 
                            {{evlDivMar}}, {{evlDivAbr}}, 
                            {{evlDivMai}}, {{evlDivJun}}, 
                            {{evlDivJul}}, {{evlDivAgo}}, 
                            {{evlDivSet}}, {{evlDivOut}}, 
                            {{evlDivNov}}, {{evlDivDes}}
                        ],
                    fill: false,
                    borderColor: 'rgba(255, 206, 86, 1)',
                    borderWidth: 3,
                    backgroundColor: 'transparent',
                },
                { 
                    label: 'Acomodador',
                    data: [{{evlAcoJan}}, {{evlAcoFev}}, 
                            {{evlAcoMar}}, {{evlAcoAbr}}, 
                            {{evlAcoMai}}, {{evlAcoJun}}, 
                            {{evlAcoJul}}, {{evlAcoAgo}}, 
                            {{evlAcoSet}}, {{evlAcoOut}}, 
                            {{evlAcoNov}}, {{evlAcoDes}}
                        ],
                    fill: false,
                    borderColor: 'rgba(0, 255, 0, 1)',
                    borderWidth: 3,
                    backgroundColor: 'transparent',
                },
            ], // fim dos conjuntos
        };

        var config2 = {
            maintainAspectRatio: true,
            title: {
                display: true,
                text: 'Evolução da Turma',
                fontSize: 30,
                fontColor: '#273c75'
            },
            elements: {
                line: {
                    tension:0
                }
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true,
                        stepSize: 1
                    }
                }]
            },
        };

        var ChartTurmaEvl = new Chart(ctx, {
            type: 'line',
            data: dados,
            options: config2,
        });
        
         //Relatório por curso contendo a evolução do curso, gráfico de linha
        var ctx = $('#evolucaoCurso');

        var dados = {
            labels: ['Jan', 'Fev', 
                    'Mar', 'Abr', 
                    'Maio', 'Jun', 
                    'Jul', 'Ago', 
                    'Set', 'Out', 
                    'Nov', 'Dez'
                ],
            datasets: [
                { 
                    label: 'Assimilador',
                    data: [{{curAssJan}}, {{curAssFev}}, 
                            {{curAssMar}}, {{curAssAbr}}, 
                            {{curAssMai}}, {{curAssJun}}, 
                            {{curAssJul}}, {{curAssAgo}}, 
                            {{curAssSet}}, {{curAssOut}}, 
                            {{curAssNov}}, {{curAssDes}}
                        ],
                    fill: false,
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 3,
                    backgroundColor: 'transparent',
                },
                { 
                    label: 'Convergente',
                    data: [{{curConJan}}, {{curConFev}}, 
                            {{curConMar}}, {{curConAbr}}, 
                            {{curConMai}}, {{curConJun}}, 
                            {{curConJul}}, {{curConAgo}}, 
                            {{curConSet}}, {{curConOut}}, 
                            {{curConNov}}, {{curConDes}}
                        ],
                    fill: false,
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 3,
                    backgroundColor: 'transparent',
                },
                { 
                    label: 'Divergente',
                    data: [{{curDivJan}}, {{curDivFev}}, 
                            {{curDivMar}}, {{curDivAbr}}, 
                            {{curDivMai}}, {{curDivJun}}, 
                            {{curDivJul}}, {{curDivAgo}}, 
                            {{curDivSet}}, {{curDivOut}}, 
                            {{curDivNov}}, {{curDivDes}}
                        ],
                    fill: false,
                    borderColor: 'rgba(255, 206, 86, 1)',
                    borderWidth: 3,
                    backgroundColor: 'transparent',
                },
                { 
                    label: 'Acomodador',
                    data: [{{curAcoJan}}, {{curAcoFev}}, 
                            {{curAcoMar}}, {{curAcoAbr}}, 
                            {{curAcoMai}}, {{curAcoJun}}, 
                            {{curAcoJul}}, {{curAcoAgo}}, 
                            {{curAcoSet}}, {{curAcoOut}}, 
                            {{curAcoNov}}, {{curAcoDes}}
                        ],
                    fill: false,
                    borderColor: 'rgba(0, 255, 0, 1)',
                    borderWidth: 3,
                    backgroundColor: 'transparent',
                },
            ] // fim dos conjuntos
        };

        var config3 = {
            maintainAspectRatio: true,
            title: {
                display: true,
                text: 'Evolução do Curso',
                fontSize: 30,
                fontColor: '#273c75'
            },
            elements: {
                line: {
                    tension:0
                }
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true,
                        stepSize: 1
                    }
                }]
            },
        };

        var ChartCursoEvl = new Chart(ctx, {
            type: 'line',
            data: dados,
            options: config3,
        });
    });

</script>

{% endblock %}